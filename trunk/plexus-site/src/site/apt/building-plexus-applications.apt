 -----
Plexus Applications and Runtimes
 -----
Trygve Laugstol
 -----

Building Plexus Applications and Runtimes

 To be able to build Plexus applications and runtimes you'll need:

 * The Plexus mojo

 * The Plexus application archetype

 * The Plexus runtime archetype

 <<<TODO: Make a link to the maven site that explains what a archetype is.>>>

Creating the Enviroment

 To start off we'll make some stub directories:

+-----------------------------------------------------------------------------+
$ mkdir my-application
$ mkdir my-runtime
+-----------------------------------------------------------------------------+

 [<<</my-application>>>] - Here we'll make a application

 [<<</my-runtime>>>] - Here we'll make a runtime that will host your
  application.  This runtime will contain startup scripts for Unix, Windows and
  OS X and will be completly standalone.

Creating a Simple Plexus Application

* Making the Application Stub

 In <<</my-application>>> execute this to make a stub Plexus application:

+-----------------------------------------------------------------------------+
$ m2 archetype:create \
    -DarchetypeGroupId=plexus \
    -DarchetypeArtifactId=plexus-archetype-application \
    -DarchetypeVersion=1.0-alpha-1-SNAPSHOT \
    -DgroupId=mygroup \
    -DartifactId=my-application \
    -Dversion=1.0 \
    -Dpackage=my.app
+-----------------------------------------------------------------------------+

* Building the Plexus Application

  <<TODO: plexus:app should not copy *.pom into /lib>>

+-----------------------------------------------------------------------------+
$ m2 plexus:app
+-----------------------------------------------------------------------------+

 Now you should have a application in <<<target/plexus-application>>>. The
 <<<plexus:app>>> goal will also package the application ready for deployment.
 Our example application JAR will be
 <<<target/my-application-1.0-application.jar>>>.

Creating the Runtime

* Making the Runtime Stub

 Creating the stub runtime is as easy as creating the application. In
 <<</my-runtime>>> execute:

+-----------------------------------------------------------------------------+
$ m2 archetype:create \
    -DarchetypeGroupId=plexus \
    -DarchetypeArtifactId=plexus-archetype-runtime \
    -DarchetypeVersion=1.0-alpha-1-SNAPSHOT \
    -DgroupId=mygroup \
    -DartifactId=my-runtime \
    -Dversion=1.0 \
    -Dpackage=my.runtime
+-----------------------------------------------------------------------------+

* Building the Runtime

  <<TODO: plexus:runtime shouldn't depend on jar:install. In fact it probably
  shouldn't copy the artifact at all as the output of a "plexus runtime"
  project is the runtime itself.>>

+-----------------------------------------------------------------------------+
$ m2 plexus:runtime
+-----------------------------------------------------------------------------+

 You should now have a usable runtime in <<<target/plexus-runtime>>> and a
 packaged runtime in <<<target/my-runtime-1.0-runtime.jar>>>. Now lets copy
 over the application:

+-----------------------------------------------------------------------------+
$ cp ../my-application/target/my-application-1.0-application.jar \
     target/plexus-runtime/apps
+-----------------------------------------------------------------------------+

 Now you have a working Plexus runtime with your application installed. To
 start it run:

+-----------------------------------------------------------------------------+
$ sh target/plexus-runtime/bin/plexus.sh
+-----------------------------------------------------------------------------+

Getting fancy: Adding a Shared Servlet Container

 Plexus runtimes can have a set of services thats shared between the applications.
 One very useful service is a servlet container. This enables several isolated applications
 to share the same Jetty instance without the need for complicated Apache HTTPD proxy
 setups. The servlet container service will deploy any WARs that is in your
 applications <<<lib>>> directory.

  <<<TODO: Give a example on how to download the service from the web.>>>

 <<<NOTE: This example assumes that you have the runtime that was created in the last section.>>>

 Copy the service from your local Maven repository:

+-----------------------------------------------------------------------------+
$ cp ~/.m2/repository/plexus/jars/plexus-service-jetty-1.0-alpha-1-SNAPSHOT-service.jar \
     my-runtime/target/plexus-runtime/services
+-----------------------------------------------------------------------------+

 As a simple web application we're using the Jetty JavaDocs. You can get them from
 <<<http://repo1.maven.org/jetty/wars/javadoc-4.2.23RC0.war>>>. Execute these
 commands from <<</my-application>>>

+-----------------------------------------------------------------------------+
$ cp ~/.m2/repository/jetty/wars/javadoc-4.2.23RC0.war \
     target/plexus-application/lib
$ m2 plexus:app
+-----------------------------------------------------------------------------+

 Remove the old application and copy it over. Execute these commands from <<</my-runtime>>>

+-----------------------------------------------------------------------------+
$ rm -rf my-runtime/target/plexus-runtime/apps/*
$ cp ../my-application/target/my-application-1.0-application.jar \
     target/plexus-runtime/apps
+-----------------------------------------------------------------------------+

 Now when the application server is started again it should

 * Deploy the servlet container.

 * Boot Jetty.

 * Deploy the application.

 * The servlet container will detect that a new application was deployed and deploy the JavaDoc WAR.

 So lets start it:

+-----------------------------------------------------------------------------+
$ sh target/plexus-runtime/bin/plexus.sh
+-----------------------------------------------------------------------------+
